var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,a=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,o=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&a(e,s,t[s]);if(i)for(var s of i(t))r.call(t,s)&&a(e,s,t[s]);return e},h=(e,i)=>t(e,s(i));import{c,a as l,u as A,b as u,d as g,v as p,e as m,p as d,B as I,T as w,M as S,N as y,f as C,G as f,W as E,S as M,O as v,g as D,h as T,l as B,y as b,i as P,j as R,H,R as F,k as Q,P as L}from"./vendor.d612bf40.js";const N=c({name:"files",initialState:{songDirectory:{}},reducers:{setSongDirectory:(e,t)=>{e.songDirectory=t.payload}}}),O=N.actions;const x=l({reducer:{files:N.reducer},middleware:e=>e({serializableCheck:!1})}),Y=u;function*G(e){for(const[t,s]of Object.entries(e))s instanceof File?yield s:yield*G(s)}const U=()=>{const e=d(),t=A(),s=Y((e=>e.files)),i=g();return p(m,null,p("input",{type:"file",webkitdirectory:!0,ref:e,onChange:e=>t(O.setSongDirectory(function(e){const t={};for(const s of e){const e=s.webkitRelativePath.split("/");let i=t;for(const[t,n]of e.entries())t<e.length-1?(i[n]=i[n]||{},i=i[n]):i[n]=s}return t}(e.target.files))),multiple:!0}),[...G(s.songDirectory)].filter((e=>e.name.endsWith(".osu"))).map((e=>{return p(m,null,p("br",null),p("button",{onClick:(t=e.webkitRelativePath,()=>{i(ae.game.route,{state:{filePath:t}})})},e.name));var t})),console.log(s))};class k{constructor(){this.noteScale=.23,this.receptorOffset=.1,this.noteGeometry=new I(1,1,1),this.noteGeometry.translate(0,.5,0),this.noteGeometry.scale(this.noteScale,this.noteScale,1),this.holdBodyGeometry=new I(1,1,1),this.holdBodyGeometry.translate(0,.5,0),this.holdBodyGeometry.scale(this.noteScale,1,1);const e=new w;this.noteMaterial=new S({map:this.applyTextureSettings(e.load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAreSURBVHhe7Z1vjF1VFcUfAUwEITRFiUqspiiQUdEo0ZhoCmMMNdrERGOIGmM0RuMHjRqFmACJ4YMxfDAKUobWpNNQpnVorVQrBRloQLGMVgtaWmxHoEJLKZ3SPxZ477rXmbXbS7un8/7ct+99b/YvWclw37377LPWmTcd5r5za0EQBEEQBEEQBEEQBEHQV2RZdqboPNE80TtEcxuNxlkQvuYxvIZzzuRlQa8h4Z0uoX5UdG29Xh8VbRFNyvGWwDW8dhS1UFMOn85hgqohAX1CdOdUfCdztP5yNvnyoWzi4HPZU4f3Zi8cncwOvXIkCV/jGF7DOTh3OjAGxuKwQdlIGHPywb9ar2eb9m3PfvKvldmnHrgue9Pqq7Pasiuz2uL3tSa5BteiBmqhJmorXAhz2EZQBhLARfIW/QQC2Xf0pey6LcNZbWSRHWgRktoYA2MBjI0e2E7gjZj/FwQxtvvv3Q3+RMlYGBOgB7YTeCLGX4MAxuWtubZ44OSQuq6BNDYXwTVsK/BC3n7XwfwFf/yBEY6PMDZAL2wr8EJMT7/atfUPvKIkY3MBTLKtwIvkvGAG4yiFbQVe0HczFE8pbCvwgr6boXhKYVuBF/TdDMVTCtsKvKDvZiieUthW4AV9N0PxlMK2Ai/ouxmKpxS2FXhB381QPKWwrcAL+m6G4imFbQVe0HczFE8pbCvwgr6boXhKYVuBF/TdDMVTCtsKvKDvZiieUthW4AV9N0PxlMK2Ai/ouxmKpxS2FXhB381QPKWwrcAL+m6G4imFbQVe0HczFE8pbCsA4sdgvV6/XrRKNNxoNL4uxy7gy4WQXBesUDylsK1CkHIXwDN4Rw+vl2ODfLmaoGlp9GeicRhyInJ8t0zqCp7eMSxrhuIphW11DDyCVyz7GuAtPJYvC/1m6hhp6uapFqfA7dI/fvyObNHGG7Iv/umn2eqnH+Ir6RbqQhYBy5mheEphWx0Bb1gueQbv4CG81FvQFXjOy8pDGl4gjWxgT6npeb/9smnUjY+v4FnFLAKWMsfylMK22iYfPryyxoK3+W8meI8MWMIXGfyX7CPbduCZ7PIN3zebzqvIRcAy5jieUthWWzQTfl7wGp4ryIKluo80+wYZcFUauNFgw81/MqeoRcAS5hieUthWy7Qa/nENpPORAUAmyIZlu4MM8BYZ6AEMuPfogexDG75jNDazilgEvNys7ymFbbVE++EfFzJAFgDZICOWLxapP08G+CsG2nrg6ax250KzoWbV6SLgpWZtTylsq2mKCP+YJAtkApjRPA5TDNLsW6Vw+vVufN+TWW3p5XYjLaqTRcDLzLqeUthWUxQavkoyQTYAWSEzDtcZUu9svLWg8KMvbMtqtxuDd6B2FwEvMWt6SmFbM9KV8FWSDTICzOxsDts+0nDafSO97Q8P2gN3qHYWAU8363lKYVunpKvhqyQj/XGA7Dh0e8gqSv+DB3vovH70c/aABanVRcBTzVqeUtjWtLiETyErZAaQIVtoDWl4fqogLHzwBnOgotXKIuBpZh1PKWzLxDN8FTJTkCVbaR5ZOel3/eUT95kDdEvNLgKeYtbwlMK2TqKM8FXIDiBLttMc0vSluBBbqNWGP2YW76aaWQR82bzeUwrbeg1lhp8k2SFDgEzZ1szIyWn/naU71tuFHTTTIuBL5rWeUtjWMUoPn0KGAJmytZmRt4zS99+BTrUIeNi8zlMK20pUJXyorX2M5OT0t8fzVn/BLOqp6RYBD5nXeEphW5UKH0KGAJmyxZmRSaT99+bf/RWzqLesRcD/NM/3lELfKhU+hAwBMkWPTSGr5SZctOqpjWbRMnTiIuCX5rmeUqoYPoQMATJlvDMjk3mbXLAfF+JuFKtwGcovAsU6z1MnUqXwkR1Alsh0Kt0mkesG09VClReBdY6n8lQxfNLeDaWyaj7OAlMbMRsDlaH8IrBe95RSpfCRlYIMGWd7SIGrWCv74eYl5oBlSBeB9ZqnQJXCR0YKsmOMnSGFPs2a2fcqtgis456qUvjIRkFmjK8YpOBnWDv77t9uNxsIlSdkoiArxlYs8q/JY/f/f2v8VrORkL+QhYKMGFd3yC+Cbzx6i9lQyE/IQOl6+Ep+EXx108/NxkLdF7xX3MJXdBHgvnR8hMlqMNQ9wfPcZwLK+ZiYDJw+HYRGPvvQjWajoeIFr3Ph+30qyEIXAR6phg8yWg2HihM81sfXlR6+Io2kf4bigYsLx35kNh7qXPBWH2oJz2l/NZCGbtNFMHj/teYEQu0LnubCv422V4v8Iij7bqJ+ErysfPiKNDiERo+8Kovg/vhx0KngIbxk+EO0udo0Go2lugg+fG+8E7QreKfhw1Pa2xvoIsBtye/9/TfNCYamFzzL3dLdW+Er8pb1K0zgpVcOZ5f94dvmREMnC17BMwAPaWdvIhNYpovgXeu+Zk44dFzwKBf+MtrY28hE0i0qk/KWNt0mUqGpTaDgEcMfpn39gUxoOSaGZ+9fuPZLpgGzWfAE3jD85bStv5CJpfu48NHlN68p/0MnVRG8yH2cewXt6k9kgiOYKDY2mnvX501DZpPgQW6TpxHa1N/IRFdiwnuOvJjNXTN7fxxg7vCA4a+kPf2PzPc0mfAoJv6sGFCFzyB6C3PG3AG9OI32zA5kwmfIxNfAgF2H92bn3HW1aVQ/CnPFnAE9OIO2zC4ajcbrxIC1MGLi4HMd7z3YE5I5Yq4Ac4cHtGN2IgacJUak/QgmDu7u70WQwp/aCR5zxtxpw+xGjDhHDElbWezAO8HIItvAXpbMCXNj+OsxZ04/AOLLuWLMPTAIO2GXsTdR1yRz0d29OcdzOe0gj3xXzBGD0tZWaWPKFZ+0De0lyRxy+/jehzlyuoGFGHS+GDUGwx7bP5HV7rjKNrYXJL1jDgx/DHPjNINTIUa9UQxLW1v8Y//OwjandpX0jN4Z/kbMidMLmkF8w0OoHoaBm1/ckfbANY2uoqRX9Aw4h2o95KlXkO8aPKDiERiZdipfdqVteJUkPeZ27H4Ec+B0gnYQA489q2DTvu2Fb1dfqKQ39Mjwi9uzf7YjRl4ohm6GsQ8//8+sNnSZHUCZkp7QG8PfjJ7ZflAE4iseWbMFBj+457FqLQLpBT0B9ljsI1uCKeS76u1i8FYYPbZni5jf/NPKuqeB1AtAb+iR7QbdgIsg/aC959nxFIAdjIcGUg8Mf3uE74QYPV8MT79k/+6/m1IQdkDd1EAam+HvRE9sL/BADL9IjN+FAH7zzJ+z2i3vNELqkmQsjMnwd6EXthV4wkWQ/sSGZ+q6LAIZQ5/fi7Ej/JKRHC6WIJ5HICP/GevuIpDaGANwzIvZRlAmCEICSfdVp2ccDX3ADrATSc3cM3gwVoRfJRCIBHMIAQ3vvLfYRSC1UBNwjAi/isjP40sloP8hqMVPritmEUgN1AKojTE4XFBFJKB3p7SEm7ettUNtQaihoDaHCaqMBPV+Zpb9YvvdZrDNCNcqqMnyQS8ggX2Q2WU3bR01Az6VcI2CWiwb9BIS3EeYYUvbuuuzCABqsFzQi0iAC5hlNvTv9Vnt1kvM0JPkNZyj4FqWCXqZ/CJIf0W07jaWY/pXPRDh9xkS6Hvk17h0rxZ24cDbPD6gCeHr3M4c23AuLwv6CQkWdxv/OiVtgNdwDk8P+hUJ+QoJe4noCWoJjvHlIAiCIAiCIAiCIAiCIAiCIAiCIAiCIOhtarX/A1KMpjj87t4EAAAAAElFTkSuQmCC")),transparent:!0}),this.holdBodyMaterial=new S({map:this.applyTextureSettings(e.load("/badmania/assets/holdbody.1310fd7c.png")),transparent:!0}),this.holdCapMaterial=new S({map:this.applyTextureSettings(e.load("/badmania/assets/holdcap.264473d7.png")),transparent:!0}),this.noteReceptorMaterial=new S({map:this.applyTextureSettings(e.load("data:image/png;base64,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")),transparent:!0}),this.noteReceptorActiveMaterial=new S({map:this.applyTextureSettings(e.load("data:image/png;base64,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")),transparent:!0})}applyTextureSettings(e){return e.anisotropy=8,e.minFilter=y,e.magFilter=y,e}meshFrom(e,t,s=-1){const i=new C(e,t.clone());return i.position.z=s,i}get noteMesh(){return this.meshFrom(this.noteGeometry,this.noteMaterial,-2)}get lnCapMesh(){return this.meshFrom(this.noteGeometry,this.holdCapMaterial,-2)}get lnMesh(){return this.meshFrom(this.holdBodyGeometry,this.holdBodyMaterial,-3)}get noteReceptorMesh(){return this.meshFrom(this.noteGeometry,this.noteReceptorMaterial,-4)}}class j{constructor(){this.General={},this.Editor={},this.Metadata={},this.Difficulty={},this.Events=[],this.TimingPoints=[],this.Colours={},this.HitObjects=[]}static parseEvent(e){const t=(s=e[0],isNaN(+s)?e[0]:parseInt(e[0]));var s;const i=parseInt(e[1]);switch(t){case 0:return{type:"background",filename:e[2],xOffset:parseInt(e[3]),yOffset:parseInt(e[4])};case 1:case"Video":return{type:"video",startTime:i,xOffset:parseInt(e[3]),yOffset:parseInt(e[4])};case 2:case"Break":return{type:"break",startTime:i,endTime:parseInt(e[2])};default:return e}}static parseHitObject(e){const t=(s=parseInt(e[3]),[...Array(8)].map(((e,t)=>s>>t&1)));var s;const i=e[e.length-1].split(":"),n=["circle","slider","spinner","maniaHold"][[0,1,3,7].reduce(((e,s,i)=>e=t[s]&&e<0?i:e),-1)],r={x:parseInt(e[0]),y:parseInt(e[1]),time:parseInt(e[2]),type:n,hitSound:parseInt(e[4]),newCombo:!!t[2],skipCombo:(a=t.slice(4,7),a.reduce(((e,t)=>e<<1|t))),hitSample:{normalSet:parseInt(i[0]),additionSet:parseInt(i[1]),index:parseInt(i[2]),volume:parseInt(i[3]),filename:i[4]}};var a;switch(n){case"slider":const t=e[5].split("|");return h(o({},r),{curveType:["bezier","catmull","linear","circle"]["BCLP".indexOf(t[0])],curvePoints:t.slice(1).map((e=>{const t=e.split(":");return{x:parseInt(t[0]),y:parseInt(t[1])}})),slides:parseInt(e[6]),length:parseFloat(e[7]),edgeSounds:e[8].split("|").map((e=>parseInt(e))),edgeSets:e[9].split("|").map((e=>{const t=e.split(":");return{normalSet:parseInt(t[0]),additionSet:parseInt(t[1])}}))});case"spinner":case"maniaHold":return h(o({},r),{endTime:parseInt(e[5])});case"circle":default:return r}}static parseTimingPoint(e){return{time:parseInt(e[0]),beatLength:parseFloat(e[1]),meter:parseInt(e[2]),sampleSet:parseInt(e[3]),sampleIndex:parseInt(e[4]),volume:parseInt(e[5]),uninherited:parseInt(e[6]),effects:parseInt(e[7])}}static parseCsvString(e,t){switch(e){case"Events":return j.parseEvent(t);case"TimingPoints":return j.parseTimingPoint(t);case"HitObjects":return j.parseHitObject(t);default:return t}}fromString(e){const t=new Set(["Events","TimingPoints","HitObjects"]),s=e.split(/\r?\n/g);let i=null;for(const[n,r]of s.entries()){const e=r.trim();if(e.length<=0||e.startsWith("//"))continue;if(0===n){this.formatVersion=parseInt((e.match(/osu file format v(\d+)/)||[])[1]);continue}{const t=(e.match(/\[(\w+)\]/)||[])[1];if(t){i=t;continue}}if(null===i)continue;const s=this[i];if(t.has(i)){const t=e.split(",");s.push(j.parseCsvString(i,t))}else{const t=e.match(/(\w+)[ ]*:[ ]*(.+)/)||[];if(t.length>0){s[t[1]]=t[2];continue}}}}toChart(){const e=parseInt(this.Difficulty.CircleSize),t=this.HitObjects.reduce(((t,s)=>t.concat({lane:Math.trunc(s.x*e/512),startTime:s.time,endTime:"maniaHold"===s.type?s.endTime:void 0})),[]);return{keys:e,notes:t}}}var z,W,V,J;(W=z||(z={}))[W.MARVELOUS=0]="MARVELOUS",W[W.PERFECT=1]="PERFECT",W[W.GREAT=2]="GREAT",W[W.GOOD=3]="GOOD",W[W.MISS=4]="MISS",W[W.NOT_HIT=5]="NOT_HIT",(J=V||(V={}))[J.NOT_HIT=0]="NOT_HIT",J[J.HIT=1]="HIT",J[J.HELD=2]="HELD",J[J.MISSED=3]="MISSED";class X{constructor(e){this.queue=[],this.newMesh=e}popOrNew(){return this.queue.length>0?this.queue.pop():this.newMesh()}push(e){e&&this.queue.push(e)}}class q{constructor(e){this.skin=e,this.noteMeshQueue=new X((()=>e.noteMesh)),this.lnMeshQueue=new X((()=>e.lnMesh)),this.lnCapQueue=new X((()=>e.lnCapMesh))}getNote(e=!1){const t=this.noteMeshQueue.popOrNew();if(!e)return t;return[t,this.lnMeshQueue.popOrNew(),this.lnCapQueue.popOrNew()]}releaseNote(e,t,s){this.noteMeshQueue.push(e),this.lnMeshQueue.push(t),this.lnCapQueue.push(s)}}class K{constructor(e,t,s){this.state=0,this.noteGroup=new f,this.skin=t,this.startTime=e,this.noteGroup.position.y=100,this.noteQueue=s}set noteVisibility(e){this.noteGroup.visible=!1}createLn(e){this.endTime=e}getYFromTime(e,t,s){return(e-t)*s+this.yOrigin}getMeshes(){const e=this.noteQueue.getNote(this.isLn);Array.isArray(e)?([this.mesh,this.lnMesh,this.lnCap]=e,this.lnMesh.position.y=this.skin.noteScale/2,this.noteGroup.add(this.lnMesh),this.noteGroup.add(this.lnCap)):this.mesh=e,this.noteGroup.add(this.mesh)}releaseMeshes(){this.noteQueue.releaseNote(this.mesh,this.lnMesh,this.lnCap)}update(e,t){this.mesh||this.getMeshes();const s=this.getYFromTime(this.startTime,e,t);if(this.noteGroup.position.y=s,(1===this.state||!this.isLn&&3===this.state)&&(this.noteVisibility=!1),this.isLn){const i=this.getYFromTime(this.endTime,e,t),n=this.yOrigin,r=this.endHitTime&&this.getYFromTime(this.endHitTime,e,t);let a=i-s;n>s&&(2===this.state?(a=i-n,this.noteGroup.position.y=n):r&&r>=s&&(a=i-r,this.noteGroup.position.y=r)),this.lnMesh.scale.y=a-this.skin.noteScale/2,this.lnCap.position.y=a}}setState(e,t){if(2===e){if(!this.isLn)throw new Error("Regular notes cannot be set to held state");if(null===t)throw new Error("Time required when setting non-held states")}return 2!==e&&2===this.state&&(this.endHitTime=t),null!=this.startHitTime||(this.startHitTime=t),this.state=e,e}get isLn(){return!!this.endTime}get yOrigin(){return this.skin.receptorOffset-1}isLnOnScreen(e,t){if(!this.isLn)return!1;const s=this.getYFromTime(this.startTime,e,t);return this.getYFromTime(this.endTime,e,t)>=-2&&s<=1}isNoteOnScreen(e,t){const s=this.getYFromTime(this.startTime,e,t);return this.isLnOnScreen(e,t)||s>=-2&&s<=1}isAboveScreen(e,t){return this.getYFromTime(this.startTime,e,t)>1}}class Z{constructor(e,t){this.notes=[],this.lastActiveState=!1,this.lastNoteHitIndex=-1,this.lastVisualNote=0,this.laneGroup=new f,this.skin=e,this.noteReceptor=e.noteReceptorMesh,this.noteReceptor.position.y=e.receptorOffset-1,this.laneGroup.add(this.noteReceptor),this.noteQueue=t}initScene(e){e.add(this.laneGroup)}set noteReceptorActive(e){this.noteReceptor.material=e?this.skin.noteReceptorActiveMaterial:this.skin.noteReceptorMaterial,this.noteReceptor.material.needsUpdate=!0}get currentNote(){return this.notes[this.lastNoteHitIndex+1]}handleLnJudge(e,t,s,i){const n=i.getJudge(t,e.startTime);if(s&&e.state===V.HELD&&t>=e.endTime)return console.log("holding ln"),[e.setState(V.HIT,t),e.startHitTime-e.startTime];if(this.lastActiveState!==s){if(s)return console.log("ln hit"),[e.setState(n===z.MISS?V.MISSED:V.HELD,t),t-e.startTime];if(console.log("ln release"),e.state===V.HELD)return e.endTime-t<=200?[e.setState(V.HIT,t),e.startHitTime-e.startTime]:[e.setState(V.MISSED,t),i.missTiming]}return null}handleNoteJudge(e,t,s,i){const n=i.getJudge(t,e.startTime);return this.lastActiveState!==s&&n!==z.NOT_HIT&&s?(console.log("normal note hit"),[e.setState(n===z.MISS?V.MISSED:V.HIT,t),t-e.startTime]):null}handleNoteInput(e,t,s,i){const n=i.getJudge(t,e.startTime);return e.state!==V.HELD&&n===z.MISS&&t>e.startTime?(console.log("note expired"),[e.setState(V.MISSED,t),i.missTiming]):e.isLn?this.handleLnJudge(e,t,s,i):this.handleNoteJudge(e,t,s,i)}update(e,t,s,i,n){this.lastActiveState!==t&&(this.noteReceptorActive=t),(()=>{for(let t=this.lastVisualNote;t<this.notes.length;t++){const i=this.notes[t];if(i.isAboveScreen(e,s))break;i.update(e,s),i.isNoteOnScreen(e,s)||(i.releaseMeshes(),this.lastVisualNote=t+1)}})();let r=null;const a=this.currentNote;if(void 0!==a){const s=this.handleNoteInput(a,e,t,i);if(null!==s){let e;if([e,r]=s,e!==V.HELD){const e=i.scoreHitDelta(r);n.recalculateAccuracy(e,i.maxScore),this.lastNoteHitIndex++}e===V.MISSED?n.combo=0:e===V.HIT&&n.combo++}}return this.lastActiveState=t,r}addNote(e,t=-1){const s=new K(e,this.skin,this.noteQueue);t>=0&&s.createLn(t),this.notes.push(s),this.laneGroup.add(s.noteGroup)}}class _{constructor(e,t,s,i){this.baseSpeed=e,this.skin=t,this.lanes=[],this.judgement=s,this.scoreboard=i,this.noteQueue=new q(t)}initScene(e){this.lanes.forEach((t=>t.initScene(e)))}update(e,t){this.lanes.forEach(((s,i)=>{s.update(e,t[i],this.baseSpeed,this.judgement,this.scoreboard)})),this.scoreboard.update()}loadChart(e){console.log(e);const t=e.keys;this.lanes=e.notes.reduce(((e,t)=>{const s=t.lane;return e.laneObjects[s].addNote(t.startTime,t.endTime),e}),{laneObjects:[...Array(t)].map((e=>new Z(this.skin,this.noteQueue)))}).laneObjects}}const $={};class ee{isPressed(e){var t;return null!=(t=$[e])&&t}setup(){window.addEventListener("keydown",(e=>$[e.key]=!0)),window.addEventListener("keyup",(e=>$[e.key]=!1))}}class te{constructor(e){this.combo=0,this.accuracy=0,this.noteCounter=0,this.accuracyScore=0,this.setUiState=e}recalculateAccuracy(e,t){this.accuracy=(this.accuracyScore+=e)/++this.noteCounter/t*100}update(){this.setUiState({combo:this.combo,accuracy:this.accuracy})}}class se{constructor(e){this.timings=[[22,45,90,135,180],[18,38,76,113,151]],this.timingScales=[1,1,1,1,.84,.66,.5,.33,.2],this.judgeTiming=this.timings[0],this.timingScale=this.timingScales[e-1]}scoreHitDelta(e){const t=5*this.timingScale,s=180*this.timingScale,i=65*this.timingScale**.75,n=22.7*this.timingScale**.75;return e<=t?this.maxScore:e<=i?this.maxScore*(e=>{const t=e<0?-1:1,s=1/(1+.3275911*(e=Math.abs(e)));return t*(1-[.254829592,-.284496736,1.421413741,-1.453152027,1.061405429].reduceRight(((e,t)=>e*s+t))*s*Math.exp(-e*e))})((i-e)/n):e<=s?-5.5*(e-i)/(s-i):this.maxScore}get maxScore(){return 2}get autoPlayHitTime(){return this.judgeTiming[0]}getJudge(e,t){const s=e-t,i=Math.abs(s);return i<=this.judgeTiming[z.MISS]?this.judgeTiming.findIndex((e=>i<=e)):s>0?z.MISS:z.NOT_HIT}get missTiming(){return this.judgeTiming[this.judgeTiming.length-1]}}class ie{constructor(e,t,s){this.updateTime=-1,this.time=0,this.isRenderRunning=!1,this.render=s,this.audio=t,this.renderer=new E({canvas:e}),this.scene=new M,this.camera=new v(-1,1,1,-1,.1,100)}start(){this.isRenderRunning||this.startEngine(),this.audio.play()}pause(){this.audio.pause()}handleResize(e,t){const s=e.domElement,i=s.clientWidth,n=s.clientHeight;if(s.width!==i||s.height!==n){e.setSize(i,n,!1);const s=i/n;t.left=-s,t.right=s,t.updateProjectionMatrix()}}startEngine(){const e=new D;e.showPanel(1),document.body.appendChild(e.dom),this.stats=e,this.isRenderRunning=!0,requestAnimationFrame(this.update.bind(this))}update(){var e,t;null==(e=this.stats)||e.begin(),this.handleResize(this.renderer,this.camera);const s=performance.now();if(this.audio.playing()){this.updateTime>0&&(this.time+=s-this.updateTime);const e=this.time-1e3*this.audio.seek();Math.abs(e)>10&&(this.time=1e3*this.audio.seek())}this.updateTime=s,this.render.call(this,this.time),this.renderer.renderLists.dispose(),this.renderer.render(this.scene,this.camera),null==(t=this.stats)||t.end(),requestAnimationFrame(this.update.bind(this))}}const ne=({state:{combo:e,accuracy:t}})=>p("div",{class:"fillScreen",style:"position: absolute"},p("p",{style:"float: right; color:white"},p("p",null,e),p("p",null,t.toFixed(4),"%"))),re=()=>{const{state:e}=T(),t=d(),[s,i]=B({combo:0,accuracy:0}),n=Y((e=>e.files)),r=g();return b((()=>{if(!(null==e?void 0:e.filePath))return r(ae.index.route);const s=t.current;if(null!==s){const t=async e=>new Promise(((t,s)=>{const i=new FileReader;i.onload=()=>{t(i.result)},i.onerror=s,i.readAsDataURL(e)}));(async()=>{try{const r=function(e){const t=e.lastIndexOf("/");return[e.substring(0,t),e.substring(t+1,e.length)]}(e.filePath),a=function(e,t){let s=e;for(const i of t.split("/"))s=s[i];return s}(n.songDirectory,r[0]);console.log(r);const o=new j;o.fromString(await a[r[1]].text());const h=a[o.General.AudioFilename],c=new P.Howl({src:await t(h),volume:.1});((e,t,s,i,n)=>{const r=e.getBoundingClientRect();console.log(r);const a=new ie(e,i,(function(e){h.update(e,[o.isPressed("z"),o.isPressed("x"),o.isPressed(","),o.isPressed(".")])})),o=new ee;o.setup();const h=new _(.0035,new k,new se(4),new te(t));h.loadChart(s),h.initScene(a.scene),console.log(h),h.lanes.forEach(((e,t)=>{e.laneGroup.position.x=t/h.lanes.length})),a.start()})(s,i,o.toChart(),c,new k)}catch(a){return console.error(a),r(ae.index.route)}})()}}),[]),p("div",{class:"fillScreen"},p("canvas",{class:"fillScreen",style:"position: absolute",ref:t}),p(ne,{state:s}))};var ae={index:{route:"/",element:p(U,null)},game:{route:"/game",element:p(re,null)}};R(p(L,{store:x},p(H,null,p(F,null,Object.values(ae).map((e=>p(Q,{path:e.route,element:e.element})))))),document.body);
